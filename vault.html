<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COSMEON | Vault Ingestion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap');
        body { 
            background: #050505; 
            color: #fff; 
            font-family: 'Space Grotesk', sans-serif; 
            background-image: radial-gradient(circle at 50% 0%, #111 0%, #050505 100%);
        }
        .glass { background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(12px); }
        .drop-zone { border: 2px dashed rgba(59, 130, 246, 0.3); transition: all 0.3s ease; }
        .drop-zone.active { border-color: #3b82f6; background: rgba(59, 130, 246, 0.05); }
        
        .progress-bar { width: 0%; transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        
        @keyframes pulse-blue {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .uploading-pulse { animation: pulse-blue 2s infinite; }
    </style>
</head>
<body class="p-4 md:p-12 min-h-screen flex items-center justify-center">
    <div class="max-w-2xl w-full">
        <!-- Header -->
        <div class="mb-8 text-center">
            <a href="dashboard.html" class="text-blue-500 text-[10px] uppercase tracking-[0.3em] hover:text-blue-400 transition-colors mb-4 inline-block">‚Üê Back to Cloud Inventory</a>
            <h1 class="text-4xl font-black italic tracking-tighter mb-2">VAULT <span class="text-blue-500 text-2xl">INGESTION</span></h1>
            <p class="text-gray-500 text-xs font-mono uppercase tracking-widest">Sharding & Encryption Engine</p>
        </div>

        <div id="uploadContainer" class="glass rounded-[2rem] p-8 shadow-2xl">
            <!-- Form Start -->
            <div id="dropZone" class="drop-zone rounded-2xl p-12 text-center cursor-pointer mb-6">
                <input type="file" id="fileInput" class="hidden">
                <div id="prompt">
                    <div class="w-16 h-16 bg-blue-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-blue-500/20">
                        <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                    </div>
                    <p class="text-sm font-bold text-gray-300">Select asset for fragmentation</p>
                    <p class="text-[10px] text-gray-500 mt-2 uppercase tracking-widest">Max 25MB per shard group</p>
                </div>
                <div id="fileDetail" class="hidden">
                    <p id="fileName" class="text-blue-400 font-bold text-lg truncate mb-1"></p>
                    <p id="fileSize" class="text-gray-500 text-xs font-mono italic"></p>
                </div>
            </div>

            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-black/40 p-3 rounded-xl border border-white/5">
                        <p class="text-[9px] text-gray-500 uppercase mb-1">Redundancy</p>
                        <p class="text-xs font-bold">3 Shard Clusters</p>
                    </div>
                    <div class="bg-black/40 p-3 rounded-xl border border-white/5">
                        <p class="text-[9px] text-gray-500 uppercase mb-1">Cipher</p>
                        <p class="text-xs font-bold text-green-500">AES-256-GCM</p>
                    </div>
                </div>

                <button id="uploadBtn" disabled class="w-full bg-blue-600 disabled:bg-gray-800 disabled:text-gray-600 hover:bg-blue-500 text-white font-black uppercase tracking-[0.2em] py-4 rounded-xl transition-all shadow-xl shadow-blue-900/20">
                    Initialize Fragmentation
                </button>
            </div>
            <!-- Form End -->

            <!-- Progress State -->
            <div id="progressState" class="hidden mt-8 pt-8 border-t border-white/5">
                <div class="flex justify-between items-end mb-2">
                    <div>
                        <p id="statusLabel" class="text-[10px] text-blue-500 font-black uppercase tracking-widest mb-1">Encrypting...</p>
                        <p id="statusSub" class="text-[9px] text-gray-500 italic">Distributing fragments to Render nodes</p>
                    </div>
                    <p id="percentLabel" class="text-sm font-mono text-white">0%</p>
                </div>
                <div class="h-1.5 w-full bg-white/5 rounded-full overflow-hidden">
                    <div id="progressBar" class="progress-bar h-full bg-blue-500"></div>
                </div>
            </div>
        </div>

        <!-- System Message -->
        <div id="sysMsg" class="mt-6 text-center opacity-0 transition-opacity">
            <p class="text-xs text-green-500 font-bold uppercase tracking-widest">Shard Repository Updated Successfully</p>
        </div>
    </div>

    <script>
        const API_URL = 'https://cosmeon-fs-lite.onrender.com';
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const progressState = document.getElementById('progressState');
        const progressBar = document.getElementById('progressBar');
        const percentLabel = document.getElementById('percentLabel');
        const statusLabel = document.getElementById('statusLabel');

        let selectedFile = null;

        // Interaction Listeners
        dropZone.onclick = () => fileInput.click();
        
        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) handleFileSelect(file);
        };

        dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('active'); };
        dropZone.ondragleave = () => dropZone.classList.remove('active');
        dropZone.ondrop = (e) => {
            e.preventDefault();
            dropZone.classList.remove('active');
            const file = e.dataTransfer.files[0];
            if (file) handleFileSelect(file);
        };

        function handleFileSelect(file) {
            selectedFile = file;
            document.getElementById('prompt').classList.add('hidden');
            document.getElementById('fileDetail').classList.remove('hidden');
            document.getElementById('fileName').innerText = file.name;
            document.getElementById('fileSize').innerText = (file.size / 1024).toFixed(2) + ' KB';
            uploadBtn.disabled = false;
        }

        uploadBtn.onclick = async () => {
            if (!selectedFile) return;

            uploadBtn.disabled = true;
            progressState.classList.remove('hidden');
            document.getElementById('uploadContainer').classList.add('uploading-pulse');

            const formData = new FormData();
            formData.append('file', selectedFile);

            try {
                // Initial Progress Simulation (Encryption Phase)
                updateProgress(25, "Encrypting Shards...");

                const xhr = new XMLHttpRequest();
                xhr.open('POST', `${API_URL}/upload`, true);

                xhr.upload.onprogress = (e) => {
                    if (e.lengthComputable) {
                        const percent = 25 + Math.round((e.loaded / e.total) * 70);
                        updateProgress(percent, "Transmitting Fragments...");
                    }
                };

                xhr.onload = function() {
                    if (xhr.status === 200 || xhr.status === 201) {
                        updateProgress(100, "Shard Distribute Verified");
                        document.getElementById('sysMsg').classList.remove('opacity-0');
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 2000);
                    } else {
                        handleError("Cluster Rejection: " + xhr.status);
                    }
                };

                xhr.onerror = () => handleError("Render Node Offline");
                xhr.send(formData);

            } catch (err) {
                handleError(err.message);
            }
        };

        function updateProgress(val, status) {
            progressBar.style.width = val + '%';
            percentLabel.innerText = val + '%';
            statusLabel.innerText = status;
        }

        function handleError(msg) {
            statusLabel.innerText = "Error: " + msg;
            statusLabel.classList.remove('text-blue-500');
            statusLabel.classList.add('text-red-500');
            uploadBtn.disabled = false;
            document.getElementById('uploadContainer').classList.remove('uploading-pulse');
        }
    </script>
</body>
</html>
